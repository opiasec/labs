<div class="mt-2">
    <div class="card">
        <div class="flex p-5"
            style="background-color: var(--p-card-background); border-radius: var(--p-card-border-radius);">
            <div class="flex-1 flex justify-content-center align-items-stretch gap-2">
                <div class="flex h-full justify-content-center align-items-end">
                    <p-avatar label="E" styleClass="mr-2" size="xlarge" />
                </div>
                <div class="flex">
                    <div class="flex flex-column align-items-start justify-content-around">
                        <span class="text-2xl font-bold">{{labResult.labSlug}}</span>
                        <span class="text-sm">Session ID: {{id}}</span>
                    </div>
                </div>
            </div>
            <div class="flex-1 flex justify-content-center align-items-center">
                <div class="flex h-full align-items-end">
                    <div *ngIf="labResult as result"
                        class="flex flex-column align-items-center justify-content-between gap-2">
                        <p-rating [(ngModel)]="result.rating" [stars]="5" (onRate)="onRate($event)"></p-rating>
                        <span>Rating</span>
                    </div>
                </div>

            </div>
            <div class="flex-1 flex justify-content-center align-items-center">
                <div class="flex h-full align-items-end">
                    <div class="flex flex-column align-items-center">
                        <span style="font-size: 3rem;">{{labResult.finishResult.totalScore}}</span>
                        <span>Score</span>

                    </div>
                </div>

            </div>
            <div class="flex-1 flex justify-content-center align-items-center">
                <div class="flex h-full align-items-center">
                    <div class="flex flex-column align-items-center justify-content-center">
                        <p-tag [value]="labResult.status" [severity]="utilsService.getStatusSeverity(labResult.status)" />

                    </div>
                </div>

            </div>


        </div>
        <div class="div">
            <p-tabs value="info">
                <p-tablist>
                    <p-tab value="info">Info</p-tab>
                    <p-tab value="files">Files</p-tab>
                </p-tablist>
                <p-tabpanel value="info">
                    <div class="flex flex-row gap-2 m-2">
                        <p-card class="flex">
                            <div class="flex justify-between gap-8">
                                <div class="flex flex-column gap-1">
                                    <span class="text-surface-500 dark:text-surface-400 text-sm">Started at</span>
                                    <span class="font-bold text-lg">{{labResult.startedAt | date:'dd/MM/yyyy
                                        HH:mm'}}</span>
                                </div>
                            </div>
                        </p-card>
                        <p-card class="flex">
                            <div class="flex justify-between gap-8">
                                <div class="flex flex-column gap-1">
                                    <span class="text-surface-500 dark:text-surface-400 text-sm">Finished at</span>
                                    <span class="font-bold text-lg">
                                        {{labResult.finishedAt && isValidDate(labResult.finishedAt) ? 
                                          (labResult.finishedAt | date:'dd/MM/yyyy HH:mm') : 'N/A'}}
                                    </span>
                                </div>
                            </div>
                        </p-card>
                    </div>
                    <p-table [value]="criteriaResult" stripedRows>
                        <ng-template #caption>
                            <div class="flex">
                                <h2 class="m-0">Criteria Results</h2>
                            </div>
                        </ng-template>
                        <ng-template #header>
                            <tr>
                                <th>Name</th>
                                <th>Score</th>
                                <th>Status</th>
                                <th style="width:10%">Raw Details</th>
                            </tr>
                        </ng-template>
                        <ng-template #body let-criterion>
                            <tr>
                                <td>{{criterion.name}}</td>
                                <td>{{criterion.score}}</td>
                                <td>{{criterion.status}}</td>
                                <td class="flex justify-content-start">
                                    <p-button icon="pi pi-code"
                                        (onClick)="onSeeCriterionDetails(criterion)"></p-button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template #emptymessage>
                            <tr>
                                <td colspan="4">No evaluations found.</td>
                            </tr>
                        </ng-template>
                    </p-table>

                </p-tabpanel>
                <p-tabpanel value="files">
                    <div class="flex flex-column">

                        <app-files-diff-viewer *ngIf="avaliacaoFilesDiff"
                            [diff]="avaliacaoFilesDiff || ''"></app-files-diff-viewer>
                    </div>
                </p-tabpanel>
            </p-tabs>
        </div>
    </div>
</div>

<p-dialog header="Avaliação" [(visible)]="avaliacaoDialog" [modal]="true" [draggable]="false" [resizable]="false"
    (onHide)="onCloseFeedbackDialog()">
    <div class="flex flex-column align-items-center gap-1">
        <p-tag value="{{avaliacaoLabSlug}}"></p-tag>
        <p-tag value="{{avaliacaoSessionId}}" [style]="{background: 'transparent', color: 'var(--text-color)'}"></p-tag>
    </div>
    <div class="flex flex-column align-items-center gap-5 mt-5">
        <p-rating [(ngModel)]="avaliacaoRating" [stars]="5"></p-rating>
        <p-floatlabel variant="on">
            <textarea pTextarea id="over_label" [(ngModel)]="avaliacaoFeedback" rows="5" cols="30" style="resize: none"
                class="h-full"></textarea>
            <label for="on_label">Feedback</label>
        </p-floatlabel>
        <div class="flex justify-content-end gap-2">
            <p-button label="Salvar" (onClick)="sendFeedback(avaliacaoSessionId)"></p-button>
            <p-button label="Cancelar" severity="danger" outlined (onClick)="avaliacaoDialog = false"></p-button>
        </div>

    </div>
</p-dialog>
